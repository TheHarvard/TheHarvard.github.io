<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P2P Ping Example</title>
<script>
    let peerConnection;
    let successCount = 0;

    // Function to start the peer connection
    function startPeerConnection(ip, port) {
        // Create a new RTCPeerConnection
        const peerConnection = new RTCPeerConnection();
        
        // Add an event listener for when the ICE candidate is found
        peerConnection.onicecandidate = event => {
            if (event.candidate) {
                // Send the ICE candidate to the other peer
                sendICECandidate(ip, port, event.candidate);
            }
        };

        // Create a data channel for communication
        const dataChannel = peerConnection.createDataChannel("pingChannel");

        // Set up event listeners for the data channel
        dataChannel.onopen = () => {
            // Send a ping message to the other peer
            dataChannel.send("ping");
        };

        dataChannel.onmessage = event => {
            // If "pong" is received, increment success count and display
            if (event.data === "pong") {
                successCount++;
                document.getElementById("successCount").innerText = "Success Count: " + successCount;
            }
        };

        // Return the peer connection
        return peerConnection;
    }

    // Function to send the ICE candidate to the other peer
    function sendICECandidate(ip, port, candidate) {
        // Create a WebSocket connection to the other peer's signaling server
        const ws = new WebSocket("ws://" + ip + ":" + port);

        // When the WebSocket connection is open, send the ICE candidate
        ws.onopen = () => {
            ws.send(JSON.stringify({ type: "candidate", candidate: candidate }));
        };
    }

    // Function to start the ping process
    function startPing() {
        // Get the IP address and port of the other device
        const ip = document.getElementById("ipAddress").value;
        const port = document.getElementById("portNumber").value;

        // Start the peer connection
        peerConnection = startPeerConnection(ip, port);
    }
</script>
</head>
<body>
<h1>P2P Ping Example</h1>
<label for="ipAddress">Enter IP Address:</label>
<input type="text" id="ipAddress" placeholder="IP Address">
<label for="portNumber">Enter Port Number:</label>
<input type="text" id="portNumber" placeholder="Port Number">
<button onclick="startPing()">Ping</button>
<div id="successCount">Success Count: 0</div>
</body>
</html>
